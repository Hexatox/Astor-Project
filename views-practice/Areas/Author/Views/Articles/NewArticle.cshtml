@using DAL.Entities;
@model IEnumerable<Catigory>

<div class="w-100 row">
    <h1 class="mt-5">Create a New Article</h1>

    <form id="articleForm" method="post" action="/author/articles/AddPost">
        <div class="form-group w-100 col-md-6">
            <label for="title">Article Title</label>
            <input type="text" class="form-control" id="title" name="title" placeholder="Article Title">
            <small class="form-text text-muted">Choose a suitable title for your article.</small>
        </div>

        <div class="form-group">
            <label for="Samary	">Article Summary</label>
            <textarea class="form-control" id="Samary" name="Samary" rows="3"></textarea>
        </div>

        <div class="form-group">
            <label for="content">Article Content</label>
            <div class="form-control w-100" id="editorjs" name="content"></div>
            <input type="hidden" id="content" name="content" /> <!-- Hidden field to store Editor.js content -->
        </div>

        <div class="rounded border border-1 d-flex flex-wrap p-1 my-5 gap-1 justify-content-center">
            @foreach (var ctgr in Model)
            {
                <div class="d-flex border rounded gap-1 p-1">
                    <label> @ctgr.CatigoryName </label>
                    <input type="checkbox" name="categoryIds" value="@ctgr.CatigoryId" />
                </div>
            }
        </div>

        <!-- Hidden input field to store selected category IDs -->
        <input type="hidden" id="categoryIds" name="categoryIds" />

        <div>
            <button type="button" onclick="submitForm()" class="btn btn-primary">Publish Article</button> <!-- Changed onclick function to submitForm -->
        </div>
    </form>
</div>
<script type="module" src="/lib/editorjs/dist/editorjs.mjs"></script>
<script src="/lib/editorjs/dist/editorjs.umd.js"></script>
<script type="module" src="/lib/editorjs/node_modules/@@editorjs/header/dist/header.mjs"></script>
<script src="/lib/editorjs/node_modules/@@editorjs/header/dist/header.umd.js"></script>
<script type="module" src="/lib/editorjs/node_modules/@@editorjs/Code/dist/Code.mjs"></script>
<script src="/lib/editorjs/node_modules/@@editorjs/Code/dist/Code.umd.js"></script>
<script type="module" src="/lib/editorjs/node_modules/@@editorjs/delimiter/dist/delimiter.mjs"></script>
<script src="/lib/editorjs/node_modules/@@editorjs/delimiter/dist/delimiter.umd.js"></script>
<script type="module" src="/lib/editorjs/node_modules/@@editorjs/simple-image/dist/simple-image.mjs"></script>
<script src="/lib/editorjs/node_modules/@@editorjs/simple-image/dist/simple-image.umd.js"></script>
<script>
    // Initialize Editor.js
    const editor = new EditorJS({
        holder: 'editorjs',
        tools: {
            header: {
                class: Header,
                inlineToolbar: true
            },
            image: {
                class: SimpleImage,
                inlineToolbar: true
            },
            code: {
                class: CodeTool,
                inlineToolbar: true
            },
            delimiter:{
class: Delimiter,
                inlineToolbar: true
            }
        }
    });

    // Custom form submission to include Editor.js content
    async function submitForm() {
        const title = document.getElementById('title').value;
        const summary = document.getElementById('Samary').value;
        const categoryIds = Array.from(document.querySelectorAll('input[name="categoryIds"]:checked')).map(checkbox => checkbox.value);

        const editorContent = await editor.save();

        // Set the Editor.js content as the value of the hidden input field in the form
        document.getElementById('content').value = JSON.stringify(editorContent);

        // Set the selected category IDs in the hidden input field
        document.getElementById('categoryIds').value = JSON.stringify(categoryIds);

        // Submit the form programmatically
        document.getElementById('articleForm').submit();
    }
</script>
